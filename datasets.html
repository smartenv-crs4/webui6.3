<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en"> <!--<![endif]-->
<head>
    <title>Open Data CP2020 | Datasets</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Favicon -->
    <link rel="shortcut icon" href="lib/img/favicon.ico">

    <!-- Web Fonts -->
    <link rel='stylesheet' type='text/css'
          href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin'>

    <!-- CSS reset -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- CSS Header and Footer -->
    <link rel="stylesheet" href="assets/css/headers/header-default.css">
    <link rel="stylesheet" href="assets/css/footers/footer-v1.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="assets/plugins/animate.css">
    <link rel="stylesheet" href="assets/plugins/line-icons/line-icons.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/plugins/owl-carousel/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/css/sky-forms.css">
    <link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/custom/custom-sky-forms.css">
    <link rel="stylesheet" href="assets/plugins/jquery/jquery-ui-1.12.1.custom/jquery-ui.css" type="text/css" media="all" />

    <!--[if lt IE 9]>
    <link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/css/sky-forms-ie8.css"><![endif]-->

    <!-- CSS Page Style -->
    <link rel="stylesheet" href="assets/css/pages/page_search.css">

    <!-- CSS Theme -->
    <link rel="stylesheet" href="assets/css/theme-colors/dark-red_.css" id="style_color">
    <link rel="stylesheet" href="assets/css/theme-skins/dark.css">

    <!-- CSS Customization -->
    <link rel="stylesheet" href="lib/css/custom.css">

    <!-- CSS Page Style Import-->
    <link rel="stylesheet" href="assets/css/pages/page_log_reg_v3.css">
</head>

<body>
<div class="wrapper">
    <!--=== Header ===-->
    <div id="header_p"></div>
    <!--=== End Header ===-->

    <!--=== Search Block ===-->
    <div class="parallaxBg">
        <div class="container" >
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
                    <!--h1>OPEN DATA <span class="color-red">Cagliari Port</span>2020</h1-->

                    <div class="input-group margin-bottom-20">
                        <span id="spanProduct" class="spanSearch">
                            <input type="text" id="searchInput" class="form-control" data-i18n="[placeholder]datasets.searchDatasets">
                            </span>
                            <span class="input-group-btn">
                                <button class="btn-u btn-u-lg" id="searchButton" type="button"><i class="fa fa-search"></i></button>
                            </span>
                        
                        
                        
                    </div>
                </div>
            </div>
            <div class="row margin-bottom-20">


                <div class="col-md-2 bg-color-semitransparent ">
                    <div class="margin-top-20 ">
                        <!--  <h2>Tags</h2>-->
                        <div class="headline-v2"><h2>Tags</h2></div>

                    </div>

                    <div id="tags_container"></div>

                </div>
                <div class="col-md-10">
                    <div class="row">
                        <div class="col-md-8">
                            <h2 class="color-red text-left"> <span class="glyphicon glyphicon-th-list"></span></a> Datasets</h2>
                        </div>
                        <div id="myDataset" class="col-md-2" hidden="hidden">
                            <a href="#" class="btn-u pull-right">My Dataset </a>
                        </div>
                        <div id="addNewDataset" class="col-md-2" hidden="hidden">
                            <!--<button class="btn-u pull-right">+ Add new Dataset</button>-->
                            <a href="add_dataset.html" class="btn-u pull-right" data-i18n="datasets.addNewDataset"></a>
                        </div>
                    </div>

                    <div class="table-search-v2" id="table-result">
                        <div class="table-responsive" id="datasetrows">
                            
                        </div>
                    </div>
                    
                    
                    <div id="divNoResult" style="display: none; margin-top: 80px">
                        <div class="col-md-8 col-md-offset-2">
                            <div class="jumbotron" style="text-align: center">
                              <h2 id="titleNoResult" data-i18n="datasets.titleNoResult"></h2>
                            </div>
                        </div>
                    </div>
                    

                    <div class="margin-bottom-30"></div>

                    <div class="text-left" id="pagination_container">

                    </div>
                </div>

            </div>


        </div>
    </div><!--/container-->

    <!--=== Footer Version 1 ===-->
    <div id="footer_p" ></div>
    <!--=== End Footer Version 1 ===-->
</div><!--/End Wrapper-->

<!-- emtpy div id=dialog //-->
<div id="dialog"></div>

<script type="text/x-handlebars-template" id="datasetrows_template">
     {{#each result}}
<div class="panel panel-default" style="padding: 10px">
            <div class="page-header">
            <h3><a data-id="{{id}}" class="lnk" style="cursor: pointer">{{title}}</a> <span class="label label-aqua">{{state}} </span>
            <span class="pull-right">
            {{#if_eq author ../session_username}}
            <button class="btn-u delete glyphicon glyphicon-trash" data-id="{{id}}" data-i18n="[title]buttons.delete"></button>
            <button class="btn-u edit glyphicon glyphicon-cog" data-id="{{id}}" data-i18n="[title]buttons.edit"></button>
            {{/if_eq}}
            <button class="btn-u lnk glyphicon glyphicon-arrow-down" id="button-{{id}}" data-id="{{id}}" data-i18n="[title]buttons.details"></button></h3>
            </span>
            </div>
            <!-- <div class="page-header"><h3><a class="lnk" data-id="{{id}}" href="dataset_detail.html?id={{id}}">{{title}}</a> <span class="label label-aqua">{{state}}</span></h3></div> -->
            <p>{{notes}}</p>
            <ul class="list-inline tags-v1  color-white">
                {{#each tags}}
                <li><a href="datasets.html?q={{display_name}}">{{display_name}}</a></li>
                {{/each}}
            </ul>
            
            <div class="panel panel-default" id="panel-{{id}}" style="display: none">
                <div class="panel-heading"><span data-i18n="datasets.manageResources"></span><span> ({{num_resources}})</span></div>                    
                
                
                    <div class="panel-body">
  
            {{#each resources}}
            
            <div class="row">
                <div class="col-md-8">
                    <div><h4>{{name}}</h4></div>

                    <p>{{description}}</p>
                    <p class="label label-default {{#if_eq format 'JSON'}}  label-success   {{/if_eq}}  {{#if_eq format 'CSV'}}  label-primary   {{/if_eq}} ">&nbsp;{{format}}&nbsp;</p>
                </div>
                <div class="col-md-2">
                    <button class="btn-u pull-right" onclick="window.location = '{{url}}'">Explore</button>
                </div>
            </div>
            
            {{/each}}
            
                </div>
             
             <div class="panel-footer">
                     <p><b><span data-i18n="dashboard.label_author"></span>:</b> <span>{{author}}</span></p>
                     <p><b><span data-i18n="dashboard.label_date"></span>:</b> <span>{{formatDate metadata_created "short"}}</span></p>
                     <p><b><span data-i18n="dashboard.label_version"></span>:</b> <span>{{version}}</span></p>
                     <p><b><span data-i18n="dashboard.label_licence"></span>:</b> <a href="{{license_url}}" target="_blank">{{license_title}}</a></p>
             </div>
            
            </div>
            
            
            </div>
        
  </div>      
    {{/each}}

    
  
    
    
</script>

<script type="text/x-handlebars-template" id="pagination_template">

    <ul class="pagination">
        {{#paginate pagination type="previous"}}
        {{#if disabled}}{{else}}
        <li><a href="#"
               onclick="javascript:getDatasets(url,'datasetrows','datasetrows_template', {{n}});">
            &lt;</a></li>
        {{/if}}
        {{/paginate}}
        {{#paginate pagination type="middle" limit="7"}}
        <li class="{{#if active}}active{{/if}} hidden-xs">
            <a href="#"
               onclick="javascript:getDatasets(url,'datasetrows','datasetrows_template', {{n}});">{{n}}</a>
        </li>
        {{/paginate}}
        {{#paginate pagination type="next"}}
        {{#if disabled}}{{else}}
        <li><a href="#"
               onclick="javascript:getDatasets(url,'datasetrows','datasetrows_template', {{n}});">
            &gt;</a></li>
        {{/if}}
        {{/paginate}}

    </ul>
</script>


<script type="text/x-handlebars-template" id="tags_template">
    <ul class="list-inline tags-v2 margin-bottom-50 color-white">
        {{#each result}}
        <li><a href="datasets.html?q={{this}}">{{this}}</a></li>
        {{/each}}
    </ul>

</script>

<!-- JS Global Compulsory -->
<script type="text/javascript" src="assets/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="assets/plugins/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/bootstrap-select.min.js"></script>
<script type="text/javascript" src="assets/plugins/jquery/jquery-ui-1.12.1.custom/jquery-ui.min.js" ></script>

<!-- JS Translation -->
<script type="text/javascript" src="assets/js/plugins/i18next.min.js"></script>
<script type="text/javascript" src="assets/js/translations/translation.js"></script>
<script type="text/javascript" src="assets/js/plugins/jquery-i18next.min.js"></script>

<!-- JS Implementing Plugins -->
<script type="text/javascript" src="assets/plugins/back-to-top.js"></script>
<script type="text/javascript" src="assets/plugins/smoothScroll.js"></script>
<script type="text/javascript" src="assets/plugins/backstretch/jquery.backstretch.min.js"></script>

<script type="text/javascript" src="assets/js/plugins/moment.js"></script>

<!-- JS Customization -->
<script type="text/javascript" src="assets/js/custom.js"></script>
<script type="text/javascript" src="assets/js/common_header.js"></script>
<script type="text/javascript" src="assets/js/handlebars-paginate.js"></script>
<script type="text/javascript" src="assets/js/sign_in_up.js"></script>
<script type="text/javascript" src="assets/js/datasets_functions.js"></script>

<script type="text/javascript" src="assets/js/app.js"></script>
<script type="text/javascript" src="assets/js/footer.js"></script>


<!-- JS Page Level -->
<script src="assets/plugins/backstretch/jquery.backstretch.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/handlebars.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/typeahead.bundle.js"></script>

<script type="text/javascript">
    var url;
    jQuery(document).ready(function () {
        App.init();
        //App.initCounter();
        //	App.initParallaxBg();
        //OwlCarousel.initOwlCarousel();
        Handlebars.registerHelper('paginate', paginate);

        url = datasetsURL;

        var query = getParameterByName('q');

        /*
            filtrare il parametro q per capire se trattasi di myDatasets o no
            in caso  la ricerca diventa url+="?q="+ sessionStorage.username
         */

        if (query){
            url+="?q="+query;
        }

        getDatasets(url,"datasetrows", "datasetrows_template", 1, 5);

        getSimple(tagsURL, "tags_container","tags_template");

        $("#searchButton").click(function () {
            var query = $("#searchInput").val();
            var page = "datasets.html";
            if (query)
                page += "?q=" + query;
            window.location = page;
        })

        if(sessionStorage)
            sessionStorage.prevPage=window.location.href;
        if(sessionStorage.username){
            $("#myDataset").show();
            $("#addNewDataset").show();
            //jQuery("#addNewDataset").prop("href", "datasets.html?q="+sessionStorage.username);
        }
        
        $("#myDataset").click(function () {
            window.location = "datasets.html?q=author_email:"+sessionStorage.email; 
        })
        
        $(".lnk").click(function () {

            
            if ($("#panel-" + $(this).attr("data-id")).css("display") == 'none')
            {
                $("#button-" + $(this).attr("data-id")).removeClass('glyphicon-arrow-down');
                $("#button-" + $(this).attr("data-id")).addClass('glyphicon-arrow-up');
                $("#panel-" + $(this).attr("data-id")).css("display","block");
            }
            
            else
            {    
                $("#button-" + $(this).attr("data-id")).removeClass('glyphicon-arrow-up');
                $("#button-" + $(this).attr("data-id")).addClass('glyphicon-arrow-down');
                $("#panel-" + $(this).attr("data-id")).css("display","none");
            }     
        })
        
        
        $(".edit").click(function () {
            window.location.href = "manage_dataset.html?id="+$(this).attr("data-id");    
        })
        
        $(".delete").click(function () {
            var id= ($(this).attr('data-id'));
            default_message_for_dialog = $.t("datasets.confirmDeleteDataset");
            var textConfirm = $.t("datasets.buttonConfirm");
            var textCancel = $.t("datasets.buttonCancel");
            var icon = '<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 0 0;"></span>';

            $('#dialog').html('<P>' + icon + default_message_for_dialog + '</P>');
            
            $( "#dialog" ).dialog({
                            dialogClass: "no-close",
                            modal: true,
                            bgiframe: true,
                            width: 300,
                            height: 200,
                            autoOpen: false,
                            title: $.t("datasets.confirmDialog"),
                            buttons: [
                                {
                                    text: textCancel,
                                    click: function() {
                                        $( this ).dialog( "close" );
                                    }
                                },
                                {
                                    text: textConfirm,
                                    click: function() {
                                        deleteDataset(id);
                                        $( this ).dialog( "close" );
                                    }
                                }
                            ]
                        });
            $("#dialog").dialog("open");  
        })
       
    });
    
    
    Handlebars.registerHelper('if_eq', function(a, b, opts) {
      if(a) a=a.toString();
      if(b) b=b.toString();
      if (a == b) {
          return opts.fn(this);
      } else {
          return opts.inverse(this);
      }
  });
  
  
  
  Handlebars.registerHelper('if_not_eq', function(a, b, opts) {
      if(a) a=a.toString();
      if(b) b=b.toString();
      if (a != b) {
          return opts.fn(this);
      } else {
          return opts.inverse(this);
      }
  });  
    
    
</script>
<!--[if lt IE 9]>
<script src="assets/plugins/respond.js"></script>
<script src="assets/plugins/html5shiv.js"></script>
<script src="assets/plugins/placeholder-IE-fixes.js"></script>
<![endif]-->
</body>
</html>
